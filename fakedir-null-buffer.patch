diff --git a/trivial_replacements.c b/trivial_replacements.c
index 8de580f..c33ef25 100644
--- a/trivial_replacements.c
+++ b/trivial_replacements.c
@@ -1,4 +1,5 @@
 #include "common.h"
+#include <string.h>
 
 /**
  * @file        trivial_replacements.c
@@ -309,8 +310,11 @@ ENDSUBST
 
 SUBST(char const *, getcwd, (char *buf, size_t size))
     pthread_mutex_unlock(&_lock);
-    getcwd(buf, size);
+    char const *cwd = getcwd(buf, size);
     pthread_mutex_lock(&_lock);
+    if (buf == NULL) {
+        buf = strdup(cwd);
+    }
     strlcpy(buf, rewrite_path_rev(buf), size);
     buf;
 ENDSUBST
